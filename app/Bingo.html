<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³“æœå¤§æŒ‘æˆ°</title>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç¤ºå…ƒä»¶å®šç¾© (æ›¿ä»£ lucide-react) ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Grid3X3 = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></IconBase>;
        const Check = (props) => <IconBase {...props}><path d="M20 6 9 17l-5-5"/></IconBase>;
        const Dices = (props) => <IconBase {...props}><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></IconBase>;
        const Dumbbell = (props) => <IconBase {...props}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const FolderOpen = (props) => <IconBase {...props}><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></IconBase>;
        const ChevronLeft = (props) => <IconBase {...props}><path d="m15 18-6-6 6-6"/></IconBase>;
        const LayoutList = (props) => <IconBase {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/><path d="M14 4h7"/><path d="M14 9h7"/><path d="M14 15h7"/><path d="M14 20h7"/></IconBase>;
        const Timer = (props) => <IconBase {...props}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Pause = (props) => <IconBase {...props}><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></IconBase>;
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;

        // --- é è¨­è³‡æ–™ ---
        const DEFAULT_LISTS = [
            {
                id: 'default-exercise',
                name: 'ğŸ’ª é‹å‹•å°æŒ‘æˆ°',
                tasks: [
                "æ·±è¹² 10 æ¬¡", "å¹³æ¿æ”¯æ’ 20 ç§’", "é–‹åˆè·³ 15 ä¸‹", "åŸåœ°è¸æ­¥ 30 ç§’", 
                "ä¼åœ°æŒºèº« 5 æ¬¡", "ç¶­æŒå–®è…³ç«™ç«‹ 10 ç§’", "ä»°è‡¥èµ·å 5 æ¬¡", "å¼“ç®­æ­¥å„ 5 æ¬¡",
                "ä¼¸å±•æ‰‹è‡‚ 10 ç§’", "é«˜æŠ¬è…¿ 20 ä¸‹"
                ]
            },
            {
                id: 'default-fun',
                name: 'ğŸ¤ª è¶£å‘³å°æŒ‘æˆ°',
                tasks: [
                "èª‡çå°æ‰‹ä¸€å¥", "å”±ä¸€é¦–æ­Œçš„å‰¯æ­Œ", "åšå€‹é¬¼è‡‰", "å¤§ç¬‘ä¸‰è²", 
                "ç”¨å±è‚¡å¯«å­—", "å­¸è²“å«ä¸‰è²", "èªªä¸€å€‹å†·ç¬‘è©±", "æ¨¡ä»¿ä¸€ç¨®å‹•ç‰©",
                "å‘å·¦é‚Šçš„äººæ¯”æ„›å¿ƒ", "è‡ªæ‹ä¸€å¼µé†œç…§"
                ]
            }
        ];

        // --- ä¸»ç¨‹å¼ ---
        const BingoGame = () => {
            const [gridSize, setGridSize] = useState(5);
            const [gameState, setGameState] = useState('setup'); 
            
            // é™æ™‚æ¨¡å¼è¨­å®š
            const [isTimeLimitMode, setIsTimeLimitMode] = useState(false);
            const [timeLimitSetting, setTimeLimitSetting] = useState(300); 
            const [isPaused, setIsPaused] = useState(false); 
            
            // éŠæˆ²æ•¸æ“š
            const [board, setBoard] = useState([]);
            const [markedIndices, setMarkedIndices] = useState(new Set());
            const [winLines, setWinLines] = useState([]);

            // è¨ˆæ™‚å™¨
            const [timeLeft, setTimeLeft] = useState(300);
            const timerRef = useRef(null);

            // ä»»å‹™æ¨¡å¼
            const [isTaskMode, setIsTaskMode] = useState(false);
            const [taskLists, setTaskLists] = useState(DEFAULT_LISTS);
            const [activeListId, setActiveListId] = useState('default-exercise');
            
            // UI ç‹€æ…‹
            const [view, setView] = useState('main'); 
            const [editingList, setEditingList] = useState(null);
            const [newTaskInput, setNewTaskInput] = useState("");

            // é€²è¡Œä¸­çš„ä»»å‹™
            const [activeTask, setActiveTask] = useState(null); 
            const [pendingMarkIndex, setPendingMarkIndex] = useState(null);

            // åˆå§‹åŒ–èˆ‡è®€å–å­˜æª”
            useEffect(() => {
                const savedData = localStorage.getItem('bingoTaskData');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        if (parsed.taskLists && Array.isArray(parsed.taskLists)) {
                        setTaskLists(parsed.taskLists);
                        setActiveListId(parsed.activeListId || parsed.taskLists[0]?.id);
                        }
                    } catch (e) { console.error("è®€å–å¤±æ•—", e); }
                } else {
                    const oldLegacyTasks = localStorage.getItem('bingoTasks');
                    if (oldLegacyTasks) {
                        try {
                        const oldTasks = JSON.parse(oldLegacyTasks);
                        const migratedList = { id: 'migrated-legacy', name: 'ğŸ“‚ æˆ‘çš„èˆŠä»»å‹™', tasks: oldTasks };
                        setTaskLists([migratedList, ...DEFAULT_LISTS]);
                        setActiveListId('migrated-legacy');
                        } catch (e) { /* ignore */ }
                    }
                }
            }, []);

            useEffect(() => {
                const dataToSave = { taskLists, activeListId };
                localStorage.setItem('bingoTaskData', JSON.stringify(dataToSave));
            }, [taskLists, activeListId]);

            // è¨ˆæ™‚å™¨é‚è¼¯
            useEffect(() => {
                if (gameState !== 'playing' || !isTimeLimitMode || winLines.length >= 5 || isPaused) {
                    if (timerRef.current) clearInterval(timerRef.current);
                    return;
                }

                timerRef.current = setInterval(() => {
                    setTimeLeft((prev) => {
                        if (prev <= 1) {
                            handleAutoPickOnTimeout();
                            return 0; 
                        }
                        return prev - 1;
                    });
                }, 1000);

                return () => {
                    if (timerRef.current) clearInterval(timerRef.current);
                };
            }, [gameState, isTimeLimitMode, winLines, isPaused]);

            // éŠæˆ²é‚è¼¯
            const initializeGame = (size) => {
                const totalCells = size * size;
                const numbers = Array.from({ length: totalCells }, (_, i) => i + 1);
                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }
                setBoard(numbers);
                setMarkedIndices(new Set());
                setWinLines([]);
                setGameState('playing');
                setActiveTask(null);
                setPendingMarkIndex(null);
                setIsPaused(false);
                setTimeLeft(timeLimitSetting);
            };

            useEffect(() => {
                if (gameState !== 'playing') return;
                const lines = [];
                const size = gridSize;
                const checkLine = (indices) => {
                    if (indices.every(idx => markedIndices.has(idx))) lines.push(indices);
                };
                for (let i = 0; i < size; i++) {
                    const row = []; for (let j = 0; j < size; j++) row.push(i * size + j);
                    checkLine(row);
                }
                for (let i = 0; i < size; i++) {
                    const col = []; for (let j = 0; j < size; j++) col.push(j * size + i);
                    checkLine(col);
                }
                const diag1 = [], diag2 = [];
                for (let i = 0; i < size; i++) {
                    diag1.push(i * size + i);
                    diag2.push(i * size + (size - 1 - i));
                }
                checkLine(diag1);
                checkLine(diag2);
                setWinLines(lines);
            }, [markedIndices, gridSize, gameState]);

            const handleAutoPickOnTimeout = () => {
                setActiveTask(null);
                setPendingMarkIndex(null);
                handleRandomPick(true); 
            };

            const triggerMarking = (index) => {
                if (isPaused) return;

                if (markedIndices.has(index)) {
                    const newMarked = new Set(markedIndices);
                    newMarked.delete(index);
                    setMarkedIndices(newMarked);
                    return;
                }

                if (isTimeLimitMode) {
                    setTimeLeft(timeLimitSetting);
                }

                if (isTaskMode) {
                    const currentList = taskLists.find(l => l.id === activeListId);
                    const currentTasks = currentList ? currentList.tasks : [];
                    if (currentTasks.length > 0) {
                        const randomTask = currentTasks[Math.floor(Math.random() * currentTasks.length)];
                        setActiveTask(randomTask);
                        setPendingMarkIndex(index);
                    } else {
                        const newMarked = new Set(markedIndices);
                        newMarked.add(index);
                        setMarkedIndices(newMarked);
                    }
                } else {
                    const newMarked = new Set(markedIndices);
                    newMarked.add(index);
                    setMarkedIndices(newMarked);
                }
            };

            const handleTaskComplete = () => {
                if (pendingMarkIndex !== null) {
                    const newMarked = new Set(markedIndices);
                    newMarked.add(pendingMarkIndex);
                    setMarkedIndices(newMarked);
                }
                setActiveTask(null);
                setPendingMarkIndex(null);
            };

            const handleRandomPick = (isForced = false) => {
                if (isPaused && !isForced) return;

                const totalCells = gridSize * gridSize;
                const unMarkedIndices = [];
                for (let i = 0; i < totalCells; i++) {
                    if (!markedIndices.has(i)) unMarkedIndices.push(i);
                }
                if (unMarkedIndices.length === 0) return;
                
                const randomIndex = Math.floor(Math.random() * unMarkedIndices.length);
                const targetIndex = unMarkedIndices[randomIndex];

                triggerMarking(targetIndex);
            };

            const isCellInWinLine = (index) => winLines.some(line => line.includes(index));

            // CRUD & Utils
            const createNewList = () => {
                const newList = { id: `custom-${Date.now()}`, name: 'æ–°ä»»å‹™åˆ—è¡¨', tasks: [] };
                setTaskLists([...taskLists, newList]);
                startEditing(newList);
            };
            const deleteList = (listId) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹åˆ—è¡¨å—ï¼Ÿ')) {
                    const newLists = taskLists.filter(l => l.id !== listId);
                    setTaskLists(newLists);
                    if (activeListId === listId && newLists.length > 0) setActiveListId(newLists[0].id);
                }
            };
            const startEditing = (list) => {
                setEditingList(JSON.parse(JSON.stringify(list)));
                setView('edit-list');
                setNewTaskInput("");
            };
            const saveEditingList = () => {
                setTaskLists(taskLists.map(l => l.id === editingList.id ? editingList : l));
                setView('manage-lists');
                setEditingList(null);
            };
            const addTaskToEditing = () => {
                if (newTaskInput.trim()) {
                    setEditingList({ ...editingList, tasks: [...editingList.tasks, newTaskInput.trim()] });
                    setNewTaskInput("");
                }
            };
            const removeTaskFromEditing = (idx) => {
                setEditingList({ ...editingList, tasks: editingList.tasks.filter((_, i) => i !== idx) });
            };
            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            // --- Render ---
            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 flex flex-col items-center py-8 px-4 font-sans relative">
                
                <header className="mb-8 text-center">
                    <h1 className="text-4xl font-bold text-slate-900 mb-2 tracking-tight flex items-center justify-center gap-3">
                    <Grid3X3 className="w-8 h-8 text-indigo-600" />
                    æ•¸å­—è³“æœ
                    </h1>
                    
                </header>

                {activeTask && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform scale-100 animate-in zoom-in-95 duration-200 relative overflow-hidden">
                        {isTimeLimitMode && !isPaused && (
                        <div className="absolute top-0 left-0 h-1.5 bg-red-500 transition-all duration-1000 ease-linear" 
                                style={{ width: `${(timeLeft / timeLimitSetting) * 100}%` }} 
                        />
                        )}

                        <div className="flex flex-col items-center text-center">
                        <div className="w-16 h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mb-4">
                            <Dumbbell className="w-8 h-8" />
                        </div>
                        <h3 className="text-xl font-bold text-slate-800 mb-2">ä»»å‹™æŒ‘æˆ°ï¼</h3>
                        
                        {isTimeLimitMode && (
                            <div className={`font-bold text-sm mb-2 flex items-center gap-1 ${isPaused ? 'text-slate-400' : 'text-red-500 animate-pulse'}`}>
                            <Timer className="w-4 h-4" /> 
                            {isPaused ? 'æš«åœä¸­' : `å‰©é¤˜ ${formatTime(timeLeft)}`}
                            </div>
                        )}

                        <div className="bg-slate-50 p-4 rounded-xl w-full mb-6 border border-slate-100">
                            <p className="text-2xl font-bold text-indigo-600 break-words">{activeTask}</p>
                        </div>
                        <p className="text-sm text-slate-500 mb-6">è«‹åœ¨æ™‚é–“å…§å®Œæˆä»»å‹™ä¸¦é¸å–ä¸‹ä¸€å€‹æ ¼å­ï¼</p>
                        
                        <div className="flex gap-3 w-full">
                            <button 
                            onClick={() => { setActiveTask(null); setPendingMarkIndex(null); }}
                            className="flex-1 py-3 px-4 rounded-xl font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors"
                            disabled={isPaused}
                            >
                            æ”¾æ£„
                            </button>
                            <button 
                            onClick={handleTaskComplete}
                            className="flex-1 py-3 px-4 rounded-xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled={isPaused}
                            >
                            å®Œæˆä»»å‹™ï¼
                            </button>
                        </div>
                        </div>
                    </div>
                    </div>
                )}

                {gameState === 'setup' && view === 'main' && (
                    <div className="w-full max-w-md bg-white p-6 rounded-2xl shadow-xl border border-slate-100 space-y-6">
                    <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <Settings className="w-5 h-5 text-slate-500" /> éŠæˆ²è¨­å®š
                    </h2>

                    <div>
                        <label className="block text-base font-medium text-slate-700 mb-3">
                        ç›¤é¢å¤§å°: {gridSize} Ã— {gridSize}
                        </label>
                        <input
                        type="range" min="3" max="10" value={gridSize}
                        onChange={(e) => setGridSize(parseInt(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                        />
                        <div className="flex justify-between text-xs text-slate-400 mt-2 px-1">
                        <span>3x3</span><span>10x10</span>
                        </div>
                    </div>

                    <div className="space-y-4">
                        <div className="flex items-center justify-between p-4 bg-orange-50 rounded-xl">
                        <div className="flex items-center gap-3">
                            <div className={`p-2 rounded-lg ${isTimeLimitMode ? 'bg-orange-200 text-orange-700' : 'bg-slate-200 text-slate-500'}`}>
                            <Timer className="w-5 h-5" />
                            </div>
                            <div className="text-left">
                            <div className="font-bold text-slate-800">é™æ™‚æ¨¡å¼</div>
                            <div className="text-xs text-slate-500">æ™‚é–“åˆ°è‡ªå‹•éš¨æ©Ÿé¸è™Ÿ</div>
                            </div>
                        </div>
                        <button 
                            onClick={() => setIsTimeLimitMode(!isTimeLimitMode)}
                            className={`w-12 h-7 rounded-full transition-colors relative ${isTimeLimitMode ? 'bg-orange-500' : 'bg-slate-300'}`}
                        >
                            <div className={`absolute top-1 left-1 bg-white w-5 h-5 rounded-full shadow-sm transition-transform ${isTimeLimitMode ? 'translate-x-5' : 'translate-x-0'}`} />
                        </button>
                        </div>

                        {isTimeLimitMode && (
                        <div className="animate-in slide-in-from-top-2">
                            <label className="block text-sm font-medium text-slate-700 mb-2">æ¯å›åˆå€’æ•¸æ™‚é–“ (ç§’)</label>
                            <div className="flex items-center gap-3">
                            <input
                                type="number" 
                                min="1" 
                                value={timeLimitSetting}
                                onChange={(e) => {
                                const val = parseInt(e.target.value);
                                if (!isNaN(val) && val > 0) setTimeLimitSetting(val);
                                }}
                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold text-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-center"
                                placeholder="è¼¸å…¥ç§’æ•¸"
                            />
                            <span className="text-slate-500 font-bold whitespace-nowrap">ç§’</span>
                            </div>
                            <p className="text-xs text-slate-400 mt-2">
                            * é»æ“Šæ ¼å­å¾Œé‡ç½®æ™‚é–“ï¼Œéœ€åœ¨æ™‚é–“å…§å®Œæˆä»»å‹™ä¸¦é¸å–ä¸‹ä¸€æ ¼
                            </p>
                        </div>
                        )}
                    </div>

                    <div className="space-y-4">
                        <div className="flex items-center justify-between p-4 bg-indigo-50 rounded-xl">
                        <div className="flex items-center gap-3">
                            <div className={`p-2 rounded-lg ${isTaskMode ? 'bg-indigo-200 text-indigo-700' : 'bg-slate-200 text-slate-500'}`}>
                            <Dumbbell className="w-5 h-5" />
                            </div>
                            <div className="text-left">
                            <div className="font-bold text-slate-800">ä»»å‹™æ¨¡å¼</div>
                            <div className="text-xs text-slate-500">é¸è™Ÿæ™‚è·³å‡ºæŒ‘æˆ°</div>
                            </div>
                        </div>
                        <button 
                            onClick={() => setIsTaskMode(!isTaskMode)}
                            className={`w-12 h-7 rounded-full transition-colors relative ${isTaskMode ? 'bg-indigo-600' : 'bg-slate-300'}`}
                        >
                            <div className={`absolute top-1 left-1 bg-white w-5 h-5 rounded-full shadow-sm transition-transform ${isTaskMode ? 'translate-x-5' : 'translate-x-0'}`} />
                        </button>
                        </div>

                        {isTaskMode && (
                        <div className="animate-in slide-in-from-top-2 space-y-3">
                            <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">é¸æ“‡ä»»å‹™åˆ—è¡¨</label>
                            <div className="flex gap-2">
                                <select 
                                value={activeListId}
                                onChange={(e) => setActiveListId(e.target.value)}
                                className="flex-1 p-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                >
                                {taskLists.map(list => (
                                    <option key={list.id} value={list.id}>
                                    {list.name} ({list.tasks.length})
                                    </option>
                                ))}
                                </select>
                                <button 
                                onClick={() => setView('manage-lists')}
                                className="p-2.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg transition-colors"
                                >
                                <LayoutList className="w-5 h-5" />
                                </button>
                            </div>
                            </div>
                        </div>
                        )}
                    </div>

                    <button
                        onClick={() => initializeGame(gridSize)}
                        className="w-full py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-lg transition-all shadow-lg shadow-indigo-200"
                    >
                        é–‹å§‹éŠæˆ²
                    </button>
                    </div>
                )}

                {gameState === 'setup' && (view === 'manage-lists' || view === 'edit-list') && (
                    <div className="w-full max-w-md bg-white p-6 rounded-2xl shadow-xl border border-slate-100 h-[500px] flex flex-col">
                    <div className="flex items-center gap-3 mb-6">
                        <button 
                        onClick={() => view === 'manage-lists' ? setView('main') : setView('manage-lists')}
                        className="p-2 hover:bg-slate-100 rounded-full transition-colors"
                        >
                        <ChevronLeft className="w-6 h-6 text-slate-500" />
                        </button>
                        <h2 className="text-xl font-bold text-slate-800">{view === 'manage-lists' ? 'ç®¡ç†åˆ—è¡¨' : 'ç·¨è¼¯åˆ—è¡¨'}</h2>
                        {view === 'edit-list' && (
                        <button onClick={saveEditingList} className="ml-auto flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-700">
                            <Save className="w-4 h-4" /> å„²å­˜
                        </button>
                        )}
                    </div>

                    {view === 'manage-lists' ? (
                        <>
                        <div className="flex-1 overflow-y-auto custom-scrollbar space-y-3 pr-1">
                            {taskLists.map(list => (
                            <div key={list.id} className="p-4 bg-slate-50 rounded-xl border border-slate-100 flex items-center justify-between">
                                <div className="flex items-center gap-3 overflow-hidden">
                                <FolderOpen className={`w-5 h-5 ${list.id === activeListId ? 'text-indigo-600' : 'text-slate-400'}`} />
                                <div>
                                    <div className="font-bold text-slate-800 truncate">{list.name}</div>
                                    <div className="text-xs text-slate-500">{list.tasks.length} å€‹ä»»å‹™</div>
                                </div>
                                </div>
                                <div className="flex gap-2">
                                <button onClick={() => startEditing(list)} className="p-2 bg-white text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-indigo-600">
                                    <Edit2 className="w-4 h-4" />
                                </button>
                                {taskLists.length > 1 && (
                                    <button onClick={() => deleteList(list.id)} className="p-2 bg-white text-slate-400 border border-slate-200 rounded-lg hover:bg-red-50 hover:text-red-500">
                                    <Trash2 className="w-4 h-4" />
                                    </button>
                                )}
                                </div>
                            </div>
                            ))}
                        </div>
                        <button onClick={createNewList} className="mt-6 w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-bold flex items-center justify-center gap-2">
                            <Plus className="w-5 h-5" /> å»ºç«‹æ–°åˆ—è¡¨
                        </button>
                        </>
                    ) : (
                        <>
                        <div className="mb-4 space-y-4">
                            <input 
                            type="text" value={editingList.name}
                            onChange={(e) => setEditingList({...editingList, name: e.target.value})}
                            className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold text-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="åˆ—è¡¨åç¨±"
                            />
                            <div className="flex gap-2">
                            <input
                                type="text" value={newTaskInput}
                                onChange={(e) => setNewTaskInput(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && addTaskToEditing()}
                                placeholder="è¼¸å…¥ä»»å‹™å…§å®¹..."
                                className="flex-1 px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            />
                            <button onClick={addTaskToEditing} disabled={!newTaskInput.trim()} className="p-2 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 disabled:opacity-50">
                                <Plus className="w-5 h-5" />
                            </button>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1">
                            {editingList.tasks.map((task, idx) => (
                            <div key={idx} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <span className="text-slate-700">{task}</span>
                                <button onClick={() => removeTaskFromEditing(idx)} className="text-slate-300 hover:text-red-500 p-1">
                                <X className="w-4 h-4" />
                                </button>
                            </div>
                            ))}
                        </div>
                        </>
                    )}
                    </div>
                )}

                {gameState === 'playing' && (
                    <div className="w-full max-w-2xl flex flex-col items-center animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="flex flex-col sm:flex-row items-center justify-between w-full mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200 gap-4 sm:gap-0">
                        <div className="flex items-center gap-3 w-full sm:w-auto">
                        <div className={`p-2 rounded-lg ${winLines.length > 0 ? 'bg-yellow-100 text-yellow-600' : 'bg-slate-100 text-slate-500'}`}>
                            <Trophy className="w-6 h-6" />
                        </div>
                        <div className="mr-4">
                            <div className="text-sm text-slate-500 font-medium">é€£ç·šæ•¸</div>
                            <div className="text-2xl font-bold text-slate-800">{winLines.length} æ¢</div>
                        </div>
                        
                        {isTimeLimitMode && (
                            <div className="flex items-center gap-3 pl-4 border-l border-slate-200">
                            <div className={`p-2 rounded-lg transition-colors ${
                                isPaused ? 'bg-slate-100 text-slate-500' : 
                                timeLeft < 10 ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-orange-100 text-orange-600'
                            }`}>
                                <Timer className="w-6 h-6" />
                            </div>
                            <div>
                                <div className="text-sm text-slate-500 font-medium">å‰©é¤˜æ™‚é–“</div>
                                <div className={`text-2xl font-bold tabular-nums ${timeLeft < 10 && !isPaused ? 'text-red-600' : 'text-slate-800'}`}>
                                {formatTime(timeLeft)}
                                </div>
                            </div>
                            
                            <button 
                                onClick={() => setIsPaused(!isPaused)}
                                className={`ml-2 p-2 rounded-full transition-all active:scale-95 border ${
                                isPaused 
                                    ? 'bg-green-100 text-green-600 border-green-200 hover:bg-green-200' 
                                    : 'bg-slate-50 text-slate-500 border-slate-200 hover:bg-slate-100'
                                }`}
                                title={isPaused ? "ç¹¼çºŒ" : "æš«åœ"}
                            >
                                {isPaused ? <Play className="w-5 h-5 fill-current" /> : <Pause className="w-5 h-5 fill-current" />}
                            </button>
                            </div>
                        )}
                        </div>
                        
                        <div className="flex flex-wrap justify-center sm:justify-end gap-2 w-full sm:w-auto">
                        <button
                            onClick={() => handleRandomPick()}
                            disabled={markedIndices.size === gridSize * gridSize || activeTask !== null || isPaused}
                            className="flex items-center gap-2 px-4 py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <Dices className="w-4 h-4" />
                            <span className="hidden sm:inline">éš¨æ©Ÿ</span>
                        </button>
                        <div className="w-px h-8 bg-slate-200 mx-1 hidden sm:block"></div>
                        <button onClick={() => initializeGame(gridSize)} className="flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors">
                            <RotateCcw className="w-4 h-4" /> <span className="hidden sm:inline">é‡ç½®</span>
                        </button>
                        <button onClick={() => setGameState('setup')} className="flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors">
                            <Settings className="w-4 h-4" /> <span className="hidden sm:inline">è¨­å®š</span>
                        </button>
                        </div>
                    </div>
                    
                    {isTimeLimitMode && winLines.length < 5 && (
                        <div className="w-full h-2 bg-slate-100 rounded-full mb-4 overflow-hidden">
                        <div 
                            className={`h-full transition-all ease-linear ${
                                isPaused ? 'bg-slate-300' :
                                timeLeft < 10 ? 'bg-red-500 duration-1000' : 'bg-orange-500 duration-1000'
                            }`}
                            style={{ width: `${(timeLeft / timeLimitSetting) * 100}%` }}
                        />
                        </div>
                    )}

                    <div 
                        className="grid gap-2 sm:gap-3 p-3 sm:p-4 bg-white rounded-2xl shadow-xl border border-slate-200 select-none relative"
                        style={{
                        gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))`,
                        width: '100%', maxWidth: '600px', aspectRatio: '1/1'
                        }}
                    >
                        {isPaused && (
                        <div className="absolute inset-0 z-20 bg-slate-100/90 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center animate-in fade-in">
                            <div className="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 flex flex-col items-center">
                            <Pause className="w-12 h-12 text-slate-400 mb-2" />
                            <span className="text-xl font-bold text-slate-600">éŠæˆ²æš«åœ</span>
                            <button 
                                onClick={() => setIsPaused(false)}
                                className="mt-4 px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold transition-colors flex items-center gap-2"
                            >
                                <Play className="w-4 h-4 fill-current" /> ç¹¼çºŒéŠæˆ²
                            </button>
                            </div>
                        </div>
                        )}

                        {board.map((num, index) => {
                        const isMarked = markedIndices.has(index);
                        const isWin = isCellInWinLine(index);
                        
                        return (
                            <div
                            key={index}
                            onClick={() => triggerMarking(index)}
                            className={`
                                relative flex items-center justify-center rounded-lg sm:rounded-xl cursor-pointer transition-all duration-200
                                text-base sm:text-xl md:text-2xl font-bold shadow-sm
                                ${isPaused ? 'cursor-not-allowed' : ''}
                                ${isWin 
                                ? 'bg-yellow-400 text-white scale-105 z-10 ring-4 ring-yellow-200 shadow-yellow-200' 
                                : isMarked 
                                    ? 'bg-indigo-600 text-white scale-[0.98] ring-0 opacity-90' 
                                    : 'bg-slate-50 text-slate-700 hover:bg-slate-100 border border-slate-200'
                                }
                            `}
                            >
                            {num}
                            {isMarked && !isWin && (
                                <div className="absolute inset-0 flex items-center justify-center opacity-20 pointer-events-none">
                                <Check className="w-3/4 h-3/4 text-white" />
                                </div>
                            )}
                            </div>
                        );
                        })}
                    </div>

                    {winLines.length >= 5 && (
                        <div className="mt-8 px-6 py-3 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-full font-bold shadow-lg animate-bounce">
                        å¤ªå¼·äº†ï¼è³“æœå¤§å¸«ï¼ ({winLines.length} é€£ç·š)
                        </div>
                    )}
                    </div>
                )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BingoGame />);
    </script>
</body>
</html>