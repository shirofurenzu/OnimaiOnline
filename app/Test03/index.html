<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒä¹…åŒ–å€’æ•¸è¨ˆæ™‚å™¨</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        #timer { font-size: 3rem; margin: 20px 0; font-weight: bold; }
        button { font-size: 1.2rem; padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>å°ˆæ³¨å€’æ•¸è¨ˆæ™‚</h1>
    <div id="timer">æº–å‚™é–‹å§‹</div>
    <button onclick="startTimer(120)">é–‹å§‹ 2 å°æ™‚è®€æ›¸</button>
    <button onclick="clearTimer()">é‡ç½®</button>

    <script>
        const timerDisplay = document.getElementById('timer');
        let intervalId;

        // 1. ç¶²é ä¸€è¼‰å…¥ï¼Œé¦¬ä¸Šæª¢æŸ¥æœ‰æ²’æœ‰æ­£åœ¨é€²è¡Œçš„å€’æ•¸
        checkTimer();

        function startTimer(minutes) {
            const now = new Date().getTime();
            // è¨ˆç®—ç›®æ¨™æ™‚é–“ï¼šç¾åœ¨æ™‚é–“ + åˆ†é˜æ•¸ * 60ç§’ * 1000æ¯«ç§’
            const targetTime = now + (minutes * 60 * 1000);
            
            // å­˜å…¥ LocalStorageï¼Œé€™å°±æ˜¯ã€Œé—œæ‰ç¶²é ä¹Ÿä¸æ€•ã€çš„é—œéµ
            localStorage.setItem('targetTime', targetTime);
            
            checkTimer(); // ç«‹å³æ›´æ–°ç•«é¢
        }

        function checkTimer() {
            // æ¯æ¬¡æª¢æŸ¥å…ˆæ¸…é™¤èˆŠçš„è¨ˆæ™‚å™¨ï¼Œé¿å…é‡è¤‡åŸ·è¡Œ
            if (intervalId) clearInterval(intervalId);

            const storedTarget = localStorage.getItem('targetTime');

            if (!storedTarget) {
                timerDisplay.textContent = "æº–å‚™é–‹å§‹";
                return;
            }

            // å•Ÿå‹•ä¸€å€‹æ¯ç§’æ›´æ–°ä¸€æ¬¡ç•«é¢çš„è¨ˆæ™‚å™¨
            // æ³¨æ„ï¼šé€™è£¡çš„ setInterval åªæ˜¯ç‚ºäº†ã€Œæ›´æ–°ç•«é¢æ•¸å­—ã€ï¼Œè€Œä¸æ˜¯ã€Œè¨ˆç®—æ™‚é–“ã€
            intervalId = setInterval(() => {
                const now = new Date().getTime();
                const distance = storedTarget - now;

                if (distance < 0) {
                    // æ™‚é–“åˆ°äº†
                    clearInterval(intervalId);
                    timerDisplay.textContent = "ğŸ‰ å·²å®Œæˆï¼";
                    // é€™è£¡å¯ä»¥é¸æ“‡æ˜¯å¦è¦ç§»é™¤ localStorage
                    // localStorage.removeItem('targetTime'); 
                } else {
                    // æ™‚é–“é‚„æ²’åˆ°ï¼Œè¨ˆç®—å‰©é¤˜çš„å°æ™‚ã€åˆ†ã€ç§’
                    const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
                    const minutes = Math.floor((distance / (1000 * 60)) % 60);
                    const seconds = Math.floor((distance / 1000) % 60);

                    timerDisplay.textContent = 
                        `${hours}å°æ™‚ ${minutes}åˆ† ${seconds}ç§’`;
                }
            }, 1000);
        }

        function clearTimer() {
            localStorage.removeItem('targetTime');
            if (intervalId) clearInterval(intervalId);
            timerDisplay.textContent = "æº–å‚™é–‹å§‹";
        }
    </script>
</body>
</html>
